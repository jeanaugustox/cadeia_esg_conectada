from empresas import menu_empresas   
from collections import Counter

certificados_registrados = []

def menu_principal():
    while True:
        print("\n" + "=" * 60)
        print("üåê CADEIA ESG CONECTADA")
        print("=" * 60)
        print("1. Gerenciar Empresas")
        print("2. Gerenciar Usu√°rios")
        print("3. Gerenciar Certificados")
        print("4. Autentica√ß√£o")
        print("0. Sair do Sistema")
        print("-" * 60)

        opcao = input("Escolha uma op√ß√£o: ").strip()

        if opcao == "1":
            menu_empresas()
        elif opcao == "2":
            menu_usuarios()
        elif opcao == "3":
            menu_certificados()
        elif opcao == "4":
            menu_autenticacao()
        elif opcao == "0":
            print("\nüëã Obrigado por usar o Cadeia ESG Conectada!")
            break
        else:
            print("‚ùå Op√ß√£o inv√°lida! Tente novamente.")
            input("\nPressione Enter para continuar...")


def menu_usuarios():
    print("\n" + "=" * 60)
    print("üìã M√≥dulo de Usu√°rios (Em constru√ß√£o)")
    print("-" * 60)
    input("Pressione Enter para continuar...")


def menu_autenticacao():
    print("\n" + "=" * 60)
    print("üîê M√≥dulo de Autentica√ß√£o (Em constru√ß√£o)")
    print("-" * 60)
    input("Pressione Enter para continuar...")


def menu_certificados():
    while True:
        print("\n" + "=" * 60)
        print("üìã M√≥dulo de Certificados")
        print("=" * 60)

        print("1. Registrar Novo Certificado")
        print("2. Ver Ranking de Empresas (Total de Certificados)")
        print("3. Voltar ao Menu Principal")
        print("-" * 60)

        escolha = input("Escolha uma op√ß√£o (1-3): ").strip()

        if escolha == "1":
            print("\nPreencha abaixo os requisitos para enviar a sua certifica√ß√£o:")
            empresa = input("Digite o nome da Empresa: ").title().strip()
            certificado = input("Digite o nome do seu certificado ESG: ").title().strip()
            categoria = input("Digite a categoria do seu certificado: ").title().strip()
            emitido = input("Digite onde foi emitido (Fonte oficial): ").title().strip()
            validade = input("Digite a data de validade: ").strip()
            emissao = input("Digite a data de emiss√£o: ").strip()

            print(
                f"\nDe acordo com as informa√ß√µes fornecidas:\n"
                f"Empresa: {empresa}\n"
                f"Certificado: {certificado}\n"
                f"Categoria: {categoria}\n"
                f"Emitido por: {emitido}\n"
                f"Emiss√£o em: {emissao}\n"
                f"V√°lido at√©: {validade}"
            )
            print("Obrigado por preencher os dados do seu certificado!")

            confirmacao = input("Voc√™ confirma a conformidade e validade das informa√ß√µes? (S/N): ").lower().strip()
            if confirmacao == "s":
                observacao_detalhe = ""
                observacao = input("Deseja destacar alguma observa√ß√£o? (S/N): ").lower().strip()

                if observacao == "s":
                    detalhe = input("Digite a sua observa√ß√£o: ").strip()
                    observacao_detalhe = detalhe
                    print("Sua observa√ß√£o foi registrada com sucesso!")
                else:
                    print("Nenhuma observa√ß√£o registrada.")

                novo_registro = {
                    "empresa": empresa,
                    "certificado": certificado,
                    "categoria": categoria,
                    "emitido": emitido,
                    "validade": validade,
                    "emissao": emissao,
                    "observacao": observacao_detalhe
                }
                certificados_registrados.append(novo_registro)
                print("‚úÖ Certificado enviado com sucesso!")
            else:
                print("‚ùå Opera√ß√£o cancelada. Por favor revise os dados.")

        elif escolha == "2":
            print("\n" + "=" * 10 + " Ranking Total de Certificados " + "=" * 10)
            if not certificados_registrados:
                print("Nenhum certificado registrado ainda.")
            else:
                lista_empresas = [cert["empresa"] for cert in certificados_registrados]
                ranking = Counter(lista_empresas)

                print(f"{'Pos.':<5} | {'Empresa':<30} | {'Qtd. Certificados':<20}")
                print("-" * 57)
                for i, (empresa, contagem) in enumerate(ranking.most_common(), 1):
                    print(f"{i:<5} | {empresa:<30} | {contagem:<20}")

        elif escolha == "3":
            print("Retornando ao menu principal...")
            break
        else:
            print("‚ùå Op√ß√£o inv√°lida. Por favor, escolha de 1 a 3.")

        input("\nPressione Enter para continuar...")

if __name__ == "__main__":
    menu_principal()
